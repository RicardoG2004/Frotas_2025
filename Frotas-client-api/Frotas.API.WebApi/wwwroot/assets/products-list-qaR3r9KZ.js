import{s as oe,_ as ne}from"./layout-bRPLI_qW.js";import{s as W,r as h,c as X,d as g,e as r,l as M,h as s,v as se,x as le,g as l,w as n,F as N,i,y as re,z as ie,f as S,A as L,B as F,t as H,j as E,m as O,k as V,C as de,D as B,E as C,G,H as ue,o as ce}from"./index-nCaapDSo.js";import{u as pe,g as ge,a as me,b as fe,c as be,F as J,_ as _e,d as ve}from"./avatar-title-group-t4BuFJuh.js";import{u as Pe,_ as K}from"./loading-button-HDMC2WxA.js";import{c as ye,a as Q}from"./index.esm-ckVFB3Pu.js";import"./logo-TZSfwjHH.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const Se={class:"card"},he={class:"card-body"},we={class:"d-flex align-items-end gap-2"},Me={class:"mb-2"},Ce=s("label",{for:"searchInput",class:"form-label"},"Search:",-1),ke=["placeholder"],xe={class:"mb-2"},De=s("div",{class:"mb-2"},[s("div",{class:"text-sm-end"})],-1),$e=s("div",{class:"text-center"},"No data available in table",-1),ze={key:0,class:"d-flex justify-content-center p-4"},Ne=s("span",{class:"spinner-border spinner-border-sm avatar-sm text-primary",role:"status","aria-hidden":"true"},null,-1),Ve=[Ne],Le={class:"table-footer"},Re={key:0},Fe={class:"d-inline-block me-3"},Be=["value"],Ae=["value"],Ie={class:"pagination pagination-rounded mb-0"},je={__name:"server-table",props:{data:Object,columns:Array,loading:Boolean,currentPageMeta:Object,tablePaginationMeta:Object,filterPlaceholder:String},emits:["onParamsChange"],setup(t,{emit:a}){const m=W(),e=t,b=a,y=[5,10,25,50],_=h([]),w=h(""),c=h({}),f=pe({get data(){return e.data},get columns(){return e.columns},manualSorting:!0,manualPagination:!0,manualFiltering:!0,getCoreRowModel:ge(),getPaginationRowModel:me(),getSortedRowModel:fe(),getFilteredRowModel:be(),initialState:{pagination:{pageSize:m.pageSize}},state:{get sorting(){return _.value}},onPaginationChange:d=>{c.value=typeof d=="function"?d(c.value):d;let o={...e.currentPageMeta};c.value.pageSize&&c.value.pageSize!=e.currentPageMeta.pageSize?(o.pageSize=c.value.pageSize,o.pageNumber=1):o.pageNumber=c.value.pageIndex,console.log(c.value),b("onParamsChange",o)},onSortingChange:d=>{_.value=typeof d=="function"?d(_.value):d;let o={...e.currentPageMeta};o.sorting=_.value,b("onParamsChange",o)}}),v=X(()=>{let d=e.tablePaginationMeta.pageSize*e.currentPageMeta.pageNumber-e.tablePaginationMeta.pageSize+1,o=e.tablePaginationMeta.pageSize*e.currentPageMeta.pageNumber,k=Math.ceil(e.tablePaginationMeta.totalCount/e.tablePaginationMeta.pageSize);return e.currentPageMeta.pageNumber==k&&(o=e.tablePaginationMeta.totalCount),e.tablePaginationMeta.totalCount==0?"No results":"Showing "+d+" to "+o+" of "+e.tablePaginationMeta.totalCount+" entries"});return(d,o)=>{const k=g("b-th"),x=g("b-tr"),D=g("b-thead"),$=g("b-td"),R=g("b-tbody"),U=g("b-table-simple"),A=g("b-pagination");return r(),M("div",Se,[s("div",he,[s("div",we,[s("div",Me,[Ce,se(s("input",{id:"searchInput",type:"text",placeholder:e.filterPlaceholder,class:"form-control","onUpdate:modelValue":o[0]||(o[0]=u=>w.value=u),style:{"max-width":"250px"}},null,8,ke),[[le,w.value]])]),s("div",xe,[s("button",{id:"filter",type:"button",class:"btn btn-info",onClick:o[1]||(o[1]=()=>b("onParamsChange",{...e.currentPageMeta,keyword:w.value}))},"Filter")]),De]),l(i(oe),{class:"table-responsive","data-simplebar-auto-hide":"false"},{default:n(()=>[l(U,{class:"table table-striped table-centered w-100 nowrap dataTable"},{default:n(()=>[l(D,null,{default:n(()=>[(r(!0),M(N,null,F(i(f).getHeaderGroups(),u=>(r(),S(x,{key:u.id},{default:n(()=>[(r(!0),M(N,null,F(u.headers,p=>(r(),S(k,{key:p.id,colSpan:p.colSpan,onClick:P=>{var I;return(I=p.column.getToggleSortingHandler())==null?void 0:I(P)},class:re({sorting:p.column.columnDef.enableSorting,sorting_desc:p.column.getIsSorted()=="desc",sorting_asc:p.column.getIsSorted()=="asc"}),style:ie({width:`${p.getSize()}px`})},{default:n(()=>[p.isPlaceholder?L("",!0):(r(),S(i(J),{key:0,render:p.column.columnDef.label,props:p.getContext()},null,8,["render","props"]))]),_:2},1032,["colSpan","onClick","class","style"]))),128))]),_:2},1024))),128))]),_:1}),t.loading?L("",!0):(r(),S(R,{key:0},{default:n(()=>[t.data.length?(r(!0),M(N,{key:0},F(i(f).getRowModel().rows,u=>(r(),S(x,{key:u.id},{default:n(()=>[(r(!0),M(N,null,F(u.getVisibleCells(),p=>(r(),S($,{key:p.id},{default:n(()=>[l(i(J),{render:p.column.columnDef.cell,props:p.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(r(),S(x,{key:1},{default:n(()=>[l($,{colspan:"4"},{default:n(()=>[$e]),_:1})]),_:1}))]),_:1}))]),_:1})]),_:1}),t.loading?(r(),M("div",ze,Ve)):L("",!0),s("div",Le,[s("div",null,[t.loading?L("",!0):(r(),M("span",Re,H(v.value),1))]),s("div",Fe,[s("select",{class:"form-select d-inline-block w-auto",value:e.currentPageMeta.pageSize,onChange:o[2]||(o[2]=u=>i(f).setPageSize(u.target.value))},[(r(),M(N,null,F(y,u=>s("option",{key:u,value:u},H(u),9,Ae)),64))],40,Be)]),s("ul",Ie,[l(A,{modelValue:e.currentPageMeta.pageNumber,"onUpdate:modelValue":[o[3]||(o[3]=u=>e.currentPageMeta.pageNumber=u),o[4]||(o[4]=u=>i(f).setPageIndex(e.currentPageMeta.pageNumber))],"total-rows":e.tablePaginationMeta.totalCount,"per-page":e.currentPageMeta.pageSize},null,8,["modelValue","total-rows","per-page"])])])])])}}},He={class:""},Ue={class:"modal-footer footer-controls border-top-0"},Te={class:"footer-controls__left"},qe={class:"footer-controls__right"},Y={__name:"product-modal",props:{title:{type:String,required:!0},data:{type:Object,required:!1},saving:{type:Boolean,default:!1},deleting:{type:Boolean,default:!1},enableDelete:{type:Boolean,default:!1}},emits:["proceed","cancel","proceedDelete"],setup(t,{emit:a}){var A,u;const m=a,e=t,b=h({name:((A=e.data)==null?void 0:A.name)||"",description:((u=e.data)==null?void 0:u.description)||""}),y=ye({name:Q().required(),description:Q().required()}),{handleSubmit:_,defineField:w,errors:c,meta:f}=Pe({initialValues:b,validationSchema:y}),[v,d]=w("name"),[o,k]=w("description"),x=X(()=>f.value.dirty&&f.value.valid),D=h(!0),$=async()=>{D.value=!1,m("cancel")},R=_(p=>{let P={...e.data,...p};m("proceed",P)}),U=_(()=>{m("proceedDelete",e.data.id)});return(p,P)=>{const I=g("b-form-input"),T=g("b-form-invalid-feedback"),q=g("b-form-group"),ee=g("b-form-textarea"),te=g("b-button"),ae=g("b-modal");return r(),S(ae,{modelValue:D.value,"onUpdate:modelValue":P[3]||(P[3]=z=>D.value=z),title:t.title,"title-class":"h4",size:"lg","hide-footer":"",onCancel:$,onClose:$,onHidden:$},{default:n(()=>[s("div",He,[s("form",{onSubmit:P[2]||(P[2]=(...z)=>i(R)&&i(R)(...z)),class:"my-2"},[l(q,{label:"Name","label-for":"name",class:"mb-2",style:{"max-width":"400px"}},{default:n(()=>[l(I,O({type:"text"},i(d),{modelValue:i(v),"onUpdate:modelValue":P[0]||(P[0]=z=>E(v)?v.value=z:null),id:"name"}),null,16,["modelValue"]),l(T,{state:!1},{default:n(()=>[V(H(i(c).name),1)]),_:1})]),_:1}),l(q,{label:"Description","label-for":"description"},{default:n(()=>[l(ee,O({type:"text",rows:"3"},i(k),{modelValue:i(o),"onUpdate:modelValue":P[1]||(P[1]=z=>E(o)?o.value=z:null)}),null,16,["modelValue"]),l(T,{state:!1},{default:n(()=>[V(H(i(c).description),1)]),_:1})]),_:1})],32)]),s("div",Ue,[s("div",Te,[t.enableDelete?(r(),S(K,{key:0,variant:"danger",type:"submit",loading:t.deleting,onClick:i(U),disabled:t.saving},{default:n(()=>[V("Delete")]),_:1},8,["loading","onClick","disabled"])):L("",!0)]),s("div",qe,[l(te,{variant:"light",onClick:$},{default:n(()=>[V("Close")]),_:1}),l(K,{variant:"primary",type:"submit",loading:t.saving,onClick:i(R),disabled:!x.value},{default:n(()=>[V("Save")]),_:1},8,["loading","onClick","disabled"])])])]),_:1},8,["modelValue","title"])}}},Z=de("products",{state:()=>({productList:{},paginationMetaData:{}}),getters:{products:t=>t.productList,paginationMeta:t=>t.paginationMetaData},actions:{async getProducts(){const t=await B.get("/products");this.productList=t.data},async getProductsPaginated(t){const a=await B.post("/products/products-paginated",t);this.productList=a.data,delete a.data,this.paginationMetaData=a},async addProduct(t){try{const a=await B.post("/products",t);return a.succeeded?(t.id=a.data,t.createdOn=new Date().toISOString(),this.productList=[t,...this.productList],C.success("New product added"),!0):(C.error(a.messages[0]),!1)}catch(a){return C.error(a),!1}},async updateProduct(t){try{const a=await B.put(`/products/${t.id}`,t);if(a.succeeded){const m=this.productList.map(e=>e.id===t.id?t:e);return this.productList=m,C.success("Product updated"),!0}else return C.error(a.messages[0]),!1}catch(a){return C.error(a),!1}},async deleteProduct(t){try{const a=await B.delete(`/products/${t}`);if(a.succeeded){const m=this.productList.filter(e=>e.id!==t);return this.productList=m,C.success("Product deleted"),!0}else return C.error(a.messages[0]),!1}catch(a){return C.error(a),!1}}}}),Ee={__name:"edit-product",props:["targetProduct"],setup(t){const a=Z(),m=t,e=h(!1),b=h(!1),y=h(!1),_=async c=>{b.value=!0,await a.updateProduct(c)&&(e.value=!1),b.value=!1},w=async c=>{y.value=!0,await a.deleteProduct(c)&&(e.value=!1),y.value=!1};return(c,f)=>{const v=g("b-button");return r(),M(N,null,[l(v,{variant:"soft-primary",pill:"",onClick:f[0]||(f[0]=d=>e.value=!0),class:"float-end"},{default:n(()=>[V("Edit")]),_:1}),e.value?(r(),S(Y,{key:0,title:"Edit Product",data:m.targetProduct,saving:b.value,deleting:y.value,onProceed:_,onProceedDelete:w,onCancel:f[1]||(f[1]=d=>e.value=!1),enableDelete:""},null,8,["data","saving","deleting"])):L("",!0)],64)}}},j=ve(),Oe=[j.accessor("name",{label:"Name",enableSorting:!0,cell:({row:t})=>G(_e,{title:t.original.name,hideAvatar:!0})}),j.accessor("description",{label:"Description",enableSorting:!0}),j.accessor("id",{label:"Guid",enableSorting:!0}),j.accessor("edit",{label:"",enableSorting:!1,cell:({row:t})=>G(Ee,{targetProduct:t.original})})],Ge=s("div",{class:"mb-2"},[s("small",null,"Server-side pagination with sorting & filtering")],-1),et={__name:"products-list",setup(t){const a=W(),m=Z(),e=h(!1),b=h(!1),y=h(!1);let _=ue({pageNumber:1,pageSize:a.pageSize,keyword:"",sorting:[]});ce(async()=>{c()});const w=v=>{_=v,c()},c=async()=>{b.value=!0,await m.getProductsPaginated(_),b.value=!1},f=async v=>{y.value=!0,await m.addProduct(v)&&(e.value=!1),y.value=!1};return(v,d)=>{const o=g("b-button"),k=g("b-col"),x=g("b-row");return r(),M(N,null,[l(ne,null,{default:n(()=>[l(x,null,{default:n(()=>[l(k,{class:"d-flex flex-row-reverse mb-3"},{default:n(()=>[l(o,{variant:"primary",onClick:d[0]||(d[0]=D=>e.value=!0)},{default:n(()=>[V("New Product")]),_:1})]),_:1})]),_:1}),l(x,null,{default:n(()=>[l(k,null,{default:n(()=>[l(je,{data:i(m).products,columns:i(Oe),loading:b.value,"current-page-meta":i(_),"table-pagination-meta":i(m).paginationMeta,onOnParamsChange:w,"filter-placeholder":"Search Products..."},null,8,["data","columns","loading","current-page-meta","table-pagination-meta"]),Ge]),_:1})]),_:1})]),_:1}),e.value?(r(),S(Y,{key:0,title:"Add New Product",saving:y.value,onProceed:f,onCancel:d[1]||(d[1]=D=>e.value=!1)},null,8,["saving"])):L("",!0)],64)}}};export{et as default};
